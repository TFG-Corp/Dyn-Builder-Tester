"use strict";if(WEBGL.isWebGLAvailable()===false){document.body.appendChild(WEBGL.getWebGLErrorMessage())}window.ImageBitmap=window.ImageBitmap||function(){return null};var container,stats,clock;var camera,controls,scene,renderer,furniture;var GlobalFullscreenMode=false;var defaults={background:false,playbackSpeed:1,actionStates:{},wireframe:false,skeleton:false,grid:false,addLights:true,exposure:1,gammaOutput:true,textureEncoding:"linear",ambientIntensity:.3,ambientColor:16777215,directIntensity:.8*Math.PI,directColor:16777215,bgColor1:"#ffffff",bgColor2:"#353535"};init();animate();function init(){container=document.getElementById("container-3D");scene=new THREE.Scene;camera=new THREE.PerspectiveCamera(15,container.clientWidth/container.clientHeight,.1,5e4);camera.position.set(640,800,640);camera.lookAt(0,3,0);controls=new THREE.OrbitControls(camera,container);scene.add(camera);scene.background=(new THREE.TextureLoader).load("image/3d-bg.jpg");clock=new THREE.Clock;var e=new THREE.HemisphereLight;e.name="hemi_light";scene.add(e);var n=new THREE.AmbientLight(defaults.ambientColor,defaults.ambientIntensity);n.name="ambient_light";camera.add(n);var r=new THREE.DirectionalLight(defaults.directColor,defaults.directIntensity);r.position.set(.5,0,.866);r.name="main_light";camera.add(r);renderer=new THREE.WebGLRenderer({antialias:true,preserveDrawingBuffer:true});renderer.setPixelRatio(window.devicePixelRatio);renderer.setSize(container.clientWidth,container.clientHeight);renderer.physicallyCorrectLights=true;renderer.setClearColor(13421772);renderer.gammaOutput=defaults.gammaOutput;renderer.gammaFactor=2.2;renderer.toneMappingExposure=defaults.exposure;container.appendChild(renderer.domElement);if(typeof Stats!="undefined"){stats=new Stats;container.appendChild(stats.dom)}window.addEventListener("resize",onWindowResize,false)}function onWindowResize(){var e,n;if(GlobalFullscreenMode){e=window.innerWidth;n=window.innerHeight}else{e=container.clientWidth;n=container.clientHeight}camera.aspect=e/n;camera.updateProjectionMatrix();renderer.setSize(e,n)}function animate(){requestAnimationFrame(animate);if(furniture!==undefined){}renderer.render(scene,camera);if(typeof Stats!="undefined"){stats.update()}}function loadFurniture(e){var n=/([^/]+)(\.\w+$)/;var r=/^.+\//;var t=r.exec(e)[0];var a=n.exec(e)[1];var i=n.exec(e)[2];var o;switch(i){case".dae":o=new THREE.ColladaLoader;o.load(e,function(e){removeFromScene(furniture);furniture=e.scene;furniture.traverse(function(e){if(e.isMesh){}});update3D();scene.add(furniture);$(".customizer").addClass("open")});break;case".obj":var s=function(e){if(e.lengthComputable){var n=e.loaded/e.total*100;console.log(Math.round(n,2)+"% downloaded")}};var l=function(){};THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader);(new THREE.MTLLoader).setPath(t).load(a+".mtl",function(e){e.preload();(new THREE.OBJLoader).setMaterials(e).setPath(t).load(a+".obj",function(e){removeFromScene(furniture);furniture=e;furniture.traverse(function(e){if(e.isMesh){}});update3D();scene.add(furniture);$(".customizer").addClass("open")},s,l)});break;case".fbx":o=new THREE.FBXLoader;o.load(e,function(e){removeFromScene(furniture);furniture=e;furniture.traverse(function(e){if(e.isMesh){}});update3D();scene.add(furniture);$(".customizer").addClass("open")});break;case".gltf":case".glb":o=(new THREE.GLTFLoader).setPath(t);o.load(a+i,function(e){removeFromScene(furniture);furniture=e.scenes[0];e.scene.traverse(function(e){if(e.isMesh){}});scene.add(e.scene);update3D();$(".customizer").addClass("open")});break;default:console.log("Not Supported 3D model format");break}updateTextureEncoding()}function updateFurniture(e){if(furniture!==undefined){for(var n=0;n<furniture.children.length;n++){furniture.children[n].visible=false}for(var n=0;n<furniture.children.length;n++){for(var r=0;r<e.length;r++){if(furniture.children[n].name===e[r]){furniture.children[n].visible=true}}}}}function saveAsImage(){var e,n;var r="image/octet-stream";try{var t="image/jpeg";e=renderer.domElement.toDataURL(t);saveFile(e.replace(t,r),"furniture.jpg")}catch(e){console.log(e)}}var saveFile=function(e,n){var r=document.createElement("a");if(typeof r.download==="string"){document.body.appendChild(r);r.download=n;r.href=e;r.click();document.body.removeChild(r)}else{location.replace(uri)}};function removeFromScene(e){scene.remove(e);animate()}function exportGLTF(e){e=e||true;var n=new THREE.GLTFExporter;var r={binary:e};n.parse(furniture.children,function(e){if(e instanceof ArrayBuffer){saveArrayBuffer(e,"furniture.glb")}else{var n=JSON.stringify(e,null,2);console.log(n);saveString(n,"furniture.gltf")}},r)}function exportCollada(){var e=new THREE.ColladaExporter;var n=e.parse(furniture);saveString(n.data,"furniture.dae");n.textures.forEach(function(e){saveArrayBuffer(e.data,e.name+"."+e.ext)})}function saveString(e,n){save(new Blob([e],{type:"text/plain"}),n)}function saveArrayBuffer(e,n){save(new Blob([e],{type:"application/octet-stream"}),n)}function save(e,n){var r=document.createElement("a");r.style.display="none";container.appendChild(r);r.href=URL.createObjectURL(e);r.download=n;r.click();r.remove()}function openFullscreen(){var e=document.getElementById("fullscreen-container");var n=document.getElementById("take-snapshot-btn");if(e.requestFullscreen){e.requestFullscreen()}else if(e.mozRequestFullScreen){e.mozRequestFullScreen()}else if(e.webkitRequestFullscreen){e.webkitRequestFullscreen()}else if(e.msRequestFullscreen){e.msRequestFullscreen()}GlobalFullscreenMode=true;container.style.width="100%";container.style.height="100%";container.classList.remove("mt-3");n.style.bottom="55px";window.addEventListener("resize",onWindowResize,false)}if(document.addEventListener){document.addEventListener("webkitfullscreenchange",fsChangeHandler,false);document.addEventListener("mozfullscreenchange",fsChangeHandler,false);document.addEventListener("fullscreenchange",fsChangeHandler,false);document.addEventListener("MSFullscreenChange",fsChangeHandler,false)}function fsChangeHandler(){var e=document.getElementById("take-snapshot-btn");if(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==undefined){GlobalFullscreenMode=true;onWindowResize()}else{GlobalFullscreenMode=false;container.style=null;container.classList.add("mt-3");e.style.bottom="145px";onWindowResize()}}function fitCameraToFurniture(e){e=e||1.25;var n=new THREE.Box3;n.setFromObject(furniture);var r=n.getCenter();var t=n.getSize();var a=Math.max(t.x,t.y,t.z);var i=camera.fov*(Math.PI/180);var o=Math.abs(a/4*Math.tan(i*2));o*=e;camera.position.z=o;var s=n.min.z;var l=s<0?-s+o:o-s;camera.far=l*3;camera.updateProjectionMatrix();if(controls){controls.target=r;controls.maxDistance=l*2;controls.saveState()}else{camera.lookAt(r)}}function traverseMaterials(e,n){e.traverse(e=>{if(!e.isMesh)return;const r=Array.isArray(e.material)?e.material:[e.material];r.forEach(n)})}function updateTextureEncoding(){let e=defaults.textureEncoding==="sRGB"?THREE.sRGBEncoding:THREE.LinearEncoding;traverseMaterials(furniture,n=>{if(n.map)n.map.encoding=e;if(n.emissiveMap)n.emissiveMap.encoding=e;if(n.map||n.emissiveMap)n.needsUpdate=true})}
//# sourceMappingURL=tfg_furniture_viewer.min.js.map