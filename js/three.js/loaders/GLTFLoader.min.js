THREE.GLTFLoader=function(){function e(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager;this.dracoLoader=null}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(r,a,e,t){var n=this;var i;if(this.resourcePath!==undefined){i=this.resourcePath}else if(this.path!==undefined){i=this.path}else{i=THREE.LoaderUtils.extractUrlBase(r)}n.manager.itemStart(r);var s=function(e){if(t){t(e)}else{console.error(e)}n.manager.itemError(r);n.manager.itemEnd(r)};var o=new THREE.FileLoader(n.manager);o.setPath(this.path);o.setResponseType("arraybuffer");o.load(r,function(e){try{n.parse(e,i,function(e){a(e);n.manager.itemEnd(r)},s)}catch(e){s(e)}},e,s)},setCrossOrigin:function(e){this.crossOrigin=e;return this},setPath:function(e){this.path=e;return this},setResourcePath:function(e){this.resourcePath=e;return this},setDRACOLoader:function(e){this.dracoLoader=e;return this},parse:function(e,r,a,t){var n;var i={};if(typeof e==="string"){n=e}else{var s=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4));if(s===E){try{i[v.KHR_BINARY_GLTF]=new m(e)}catch(e){if(t)t(e);return}n=i[v.KHR_BINARY_GLTF].content}else{n=THREE.LoaderUtils.decodeText(new Uint8Array(e))}}var o=JSON.parse(n);if(o.asset===undefined||o.asset.version[0]<2){if(t)t(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));return}if(o.extensionsUsed){for(var u=0;u<o.extensionsUsed.length;++u){var l=o.extensionsUsed[u];var f=o.extensionsRequired||[];switch(l){case v.KHR_LIGHTS_PUNCTUAL:i[l]=new d(o);break;case v.KHR_MATERIALS_UNLIT:i[l]=new h(o);break;case v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:i[l]=new g(o);break;case v.KHR_DRACO_MESH_COMPRESSION:i[l]=new T(o,this.dracoLoader);break;case v.MSFT_TEXTURE_DDS:i[v.MSFT_TEXTURE_DDS]=new c;break;case v.KHR_TEXTURE_TRANSFORM:i[v.KHR_TEXTURE_TRANSFORM]=new R(o);break;default:if(f.indexOf(l)>=0){console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}}}var p=new K(o,i,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});p.parse(a,t)}};function t(){var a={};return{get:function(e){return a[e]},add:function(e,r){a[e]=r},remove:function(e){delete a[e]},removeAll:function(){a={}}}}var v={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function c(){if(!THREE.DDSLoader){throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader")}this.name=v.MSFT_TEXTURE_DDS;this.ddsLoader=new THREE.DDSLoader}function d(e){this.name=v.KHR_LIGHTS_PUNCTUAL;var r=e.extensions&&e.extensions[v.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=r.lights||[]}d.prototype.loadLight=function(e){var r=this.lightDefs[e];var a;var t=new THREE.Color(16777215);if(r.color!==undefined)t.fromArray(r.color);var n=r.range!==undefined?r.range:0;switch(r.type){case"directional":a=new THREE.DirectionalLight(t);a.target.position.set(0,0,-1);a.add(a.target);break;case"point":a=new THREE.PointLight(t);a.distance=n;break;case"spot":a=new THREE.SpotLight(t);a.distance=n;r.spot=r.spot||{};r.spot.innerConeAngle=r.spot.innerConeAngle!==undefined?r.spot.innerConeAngle:0;r.spot.outerConeAngle=r.spot.outerConeAngle!==undefined?r.spot.outerConeAngle:Math.PI/4;a.angle=r.spot.outerConeAngle;a.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle;a.target.position.set(0,0,-1);a.add(a.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}a.position.set(0,0,0);a.decay=2;if(r.intensity!==undefined)a.intensity=r.intensity;a.name=r.name||"light_"+e;return Promise.resolve(a)};function h(){this.name=v.KHR_MATERIALS_UNLIT}h.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial};h.prototype.extendParams=function(e,r,a){var t=[];e.color=new THREE.Color(1,1,1);e.opacity=1;var n=r.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var i=n.baseColorFactor;e.color.fromArray(i);e.opacity=i[3]}if(n.baseColorTexture!==undefined){t.push(a.assignTexture(e,"map",n.baseColorTexture))}}return Promise.all(t)};var r="binary_glTF";var E="glTF";var u=12;var l={JSON:1313821514,BIN:5130562};function m(e){this.name=v.KHR_BINARY_GLTF;this.content=null;this.body=null;var r=new DataView(e,0,u);this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,true),length:r.getUint32(8,true)};if(this.header.magic!==E){throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.")}else if(this.header.version<2){throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.")}var a=new DataView(e,u);var t=0;while(t<a.byteLength){var n=a.getUint32(t,true);t+=4;var i=a.getUint32(t,true);t+=4;if(i===l.JSON){var s=new Uint8Array(e,u+t,n);this.content=THREE.LoaderUtils.decodeText(s)}else if(i===l.BIN){var o=u+t;this.body=e.slice(o,o+n)}t+=n}if(this.content===null){throw new Error("THREE.GLTFLoader: JSON content not found.")}}function T(e,r){if(!r){throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.")}this.name=v.KHR_DRACO_MESH_COMPRESSION;this.json=e;this.dracoLoader=r}T.prototype.decodePrimitive=function(e,r){var a=this.json;var t=this.dracoLoader;var n=e.extensions[this.name].bufferView;var i=e.extensions[this.name].attributes;var s={};var o={};var u={};for(var l in i){var f=_[l]||l.toLowerCase();s[f]=i[l]}for(l in e.attributes){var f=_[l]||l.toLowerCase();if(i[l]!==undefined){var p=a.accessors[e.attributes[l]];var c=H[p.componentType];u[f]=c;o[f]=p.normalized===true}}return r.getDependency("bufferView",n).then(function(e){return new Promise(function(n){t.decodeDracoFile(e,function(e){for(var r in e.attributes){var a=e.attributes[r];var t=o[r];if(t!==undefined)a.normalized=t}n(e)},s,u)})})};function R(){this.name=v.KHR_TEXTURE_TRANSFORM}R.prototype.extendTexture=function(e,r){e=e.clone();if(r.offset!==undefined){e.offset.fromArray(r.offset)}if(r.rotation!==undefined){e.rotation=r.rotation}if(r.scale!==undefined){e.repeat.fromArray(r.scale)}if(r.texCoord!==undefined){console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.')}e.needsUpdate=true;return e};function g(){return{name:v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,r,a){var t=r.extensions[this.name];var n=THREE.ShaderLib["standard"];var i=THREE.UniformsUtils.clone(n.uniforms);var s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n");var o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n");var u=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n");var l=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n");var f=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n");var p=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",u).replace("#include <metalnessmap_fragment>",l).replace("#include <lights_physical_fragment>",f);delete i.roughness;delete i.metalness;delete i.roughnessMap;delete i.metalnessMap;i.specular={value:(new THREE.Color).setHex(1118481)};i.glossiness={value:.5};i.specularMap={value:null};i.glossinessMap={value:null};e.vertexShader=n.vertexShader;e.fragmentShader=p;e.uniforms=i;e.defines={STANDARD:""};e.color=new THREE.Color(1,1,1);e.opacity=1;var c=[];if(Array.isArray(t.diffuseFactor)){var d=t.diffuseFactor;e.color.fromArray(d);e.opacity=d[3]}if(t.diffuseTexture!==undefined){c.push(a.assignTexture(e,"map",t.diffuseTexture))}e.emissive=new THREE.Color(0,0,0);e.glossiness=t.glossinessFactor!==undefined?t.glossinessFactor:1;e.specular=new THREE.Color(1,1,1);if(Array.isArray(t.specularFactor)){e.specular.fromArray(t.specularFactor)}if(t.specularGlossinessTexture!==undefined){var v=t.specularGlossinessTexture;c.push(a.assignTexture(e,"glossinessMap",v));c.push(a.assignTexture(e,"specularMap",v))}return Promise.all(c)},createMaterial:function(e){var r=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:true,lights:true,opacity:e.opacity,transparent:e.transparent});r.isGLTFSpecularGlossinessMaterial=true;r.color=e.color;r.map=e.map===undefined?null:e.map;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=e.aoMap===undefined?null:e.aoMap;r.aoMapIntensity=1;r.emissive=e.emissive;r.emissiveIntensity=1;r.emissiveMap=e.emissiveMap===undefined?null:e.emissiveMap;r.bumpMap=e.bumpMap===undefined?null:e.bumpMap;r.bumpScale=1;r.normalMap=e.normalMap===undefined?null:e.normalMap;if(e.normalScale)r.normalScale=e.normalScale;r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.specularMap=e.specularMap===undefined?null:e.specularMap;r.specular=e.specular;r.glossinessMap=e.glossinessMap===undefined?null:e.glossinessMap;r.glossiness=e.glossiness;r.alphaMap=null;r.envMap=e.envMap===undefined?null:e.envMap;r.envMapIntensity=1;r.refractionRatio=.98;r.extensions.derivatives=true;return r},cloneMaterial:function(e){var r=e.clone();r.isGLTFSpecularGlossinessMaterial=true;var a=this.specularGlossinessParams;for(var t=0,n=a.length;t<n;t++){r[a[t]]=e[a[t]]}return r},refreshUniforms:function(e,r,a,t,n,i){if(n.isGLTFSpecularGlossinessMaterial!==true){return}var s=n.uniforms;var o=n.defines;s.opacity.value=n.opacity;s.diffuse.value.copy(n.color);s.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity);s.map.value=n.map;s.specularMap.value=n.specularMap;s.alphaMap.value=n.alphaMap;s.lightMap.value=n.lightMap;s.lightMapIntensity.value=n.lightMapIntensity;s.aoMap.value=n.aoMap;s.aoMapIntensity.value=n.aoMapIntensity;var u;if(n.map){u=n.map}else if(n.specularMap){u=n.specularMap}else if(n.displacementMap){u=n.displacementMap}else if(n.normalMap){u=n.normalMap}else if(n.bumpMap){u=n.bumpMap}else if(n.glossinessMap){u=n.glossinessMap}else if(n.alphaMap){u=n.alphaMap}else if(n.emissiveMap){u=n.emissiveMap}if(u!==undefined){if(u.isWebGLRenderTarget){u=u.texture}if(u.matrixAutoUpdate===true){u.updateMatrix()}s.uvTransform.value.copy(u.matrix)}if(n.envMap){s.envMap.value=n.envMap;s.envMapIntensity.value=n.envMapIntensity;s.flipEnvMap.value=n.envMap.isCubeTexture?-1:1;s.reflectivity.value=n.reflectivity;s.refractionRatio.value=n.refractionRatio;s.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel}s.specular.value.copy(n.specular);s.glossiness.value=n.glossiness;s.glossinessMap.value=n.glossinessMap;s.emissiveMap.value=n.emissiveMap;s.bumpMap.value=n.bumpMap;s.normalMap.value=n.normalMap;s.displacementMap.value=n.displacementMap;s.displacementScale.value=n.displacementScale;s.displacementBias.value=n.displacementBias;if(s.glossinessMap.value!==null&&o.USE_GLOSSINESSMAP===undefined){o.USE_GLOSSINESSMAP="";o.USE_ROUGHNESSMAP=""}if(s.glossinessMap.value===null&&o.USE_GLOSSINESSMAP!==undefined){delete o.USE_GLOSSINESSMAP;delete o.USE_ROUGHNESSMAP}}}}function y(e,r,a,t){THREE.Interpolant.call(this,e,r,a,t)}y.prototype=Object.create(THREE.Interpolant.prototype);y.prototype.constructor=y;y.prototype.copySampleValue_=function(e){var r=this.resultBuffer,a=this.sampleValues,t=this.valueSize,n=e*t*3+t;for(var i=0;i!==t;i++){r[i]=a[n+i]}return r};y.prototype.beforeStart_=y.prototype.copySampleValue_;y.prototype.afterEnd_=y.prototype.copySampleValue_;y.prototype.interpolate_=function(e,r,a,t){var n=this.resultBuffer;var i=this.sampleValues;var s=this.valueSize;var o=s*2;var u=s*3;var l=t-r;var f=(a-r)/l;var p=f*f;var c=p*f;var d=e*u;var v=d-u;var h=-2*c+3*p;var E=c-p;var m=1-h;var T=E-p+f;for(var R=0;R!==s;R++){var g=i[v+R+s];var M=i[v+R+o]*l;var S=i[d+R+s];var L=i[d+R]*l;n[R]=m*g+T*M+h*S+E*L}return n};var M={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123};var a={5126:Number,35675:THREE.Matrix3,35676:THREE.Matrix4,35664:THREE.Vector2,35665:THREE.Vector3,35666:THREE.Vector4,35678:THREE.Texture};var H={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var S={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter};var L={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping};var n={1028:THREE.BackSide,1029:THREE.FrontSide};var i={512:THREE.NeverDepth,513:THREE.LessDepth,514:THREE.EqualDepth,515:THREE.LessEqualDepth,516:THREE.GreaterEqualDepth,517:THREE.NotEqualDepth,518:THREE.GreaterEqualDepth,519:THREE.AlwaysDepth};var s={32774:THREE.AddEquation,32778:THREE.SubtractEquation,32779:THREE.ReverseSubtractEquation};var o={0:THREE.ZeroFactor,1:THREE.OneFactor,768:THREE.SrcColorFactor,769:THREE.OneMinusSrcColorFactor,770:THREE.SrcAlphaFactor,771:THREE.OneMinusSrcAlphaFactor,772:THREE.DstAlphaFactor,773:THREE.OneMinusDstAlphaFactor,774:THREE.DstColorFactor,775:THREE.OneMinusDstColorFactor,776:THREE.SrcAlphaSaturateFactor};var A={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};var _={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"};var x={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"};var w={CUBICSPLINE:undefined,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete};var f={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};var b={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};var I={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function F(e,r){if(typeof e!=="string"||e==="")return"";if(/^(https?:)?\/\//i.test(e))return e;if(/^data:.*,.*$/i.test(e))return e;if(/^blob:.*$/i.test(e))return e;return r+e}var p;function P(){p=p||new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:false,depthTest:true,side:THREE.FrontSide});return p}function N(e,r,a){for(var t in a.extensions){if(e[t]===undefined){r.userData.gltfExtensions=r.userData.gltfExtensions||{};r.userData.gltfExtensions[t]=a.extensions[t]}}}function O(e,r){if(r.extras!==undefined){if(typeof r.extras==="object"){e.userData=r.extras}else{console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+r.extras)}}}function U(d,v,e){var h=false;var E=false;for(var r=0,a=v.length;r<a;r++){var t=v[r];if(t.POSITION!==undefined)h=true;if(t.NORMAL!==undefined)E=true;if(h&&E)break}if(!h&&!E)return Promise.resolve(d);var n=[];var i=[];for(var r=0,a=v.length;r<a;r++){var t=v[r];if(h){var s=t.POSITION!==undefined?e.getDependency("accessor",t.POSITION):d.attributes.position;n.push(s)}if(E){var s=t.NORMAL!==undefined?e.getDependency("accessor",t.NORMAL):d.attributes.normal;i.push(s)}}return Promise.all([Promise.all(n),Promise.all(i)]).then(function(e){var r=e[0];var a=e[1];for(var t=0,n=r.length;t<n;t++){if(d.attributes.position===r[t])continue;r[t]=k(r[t])}for(var t=0,n=a.length;t<n;t++){if(d.attributes.normal===a[t])continue;a[t]=k(a[t])}for(var t=0,n=v.length;t<n;t++){var i=v[t];var s="morphTarget"+t;if(h){if(i.POSITION!==undefined){var o=r[t];o.name=s;var u=d.attributes.position;for(var l=0,f=o.count;l<f;l++){o.setXYZ(l,o.getX(l)+u.getX(l),o.getY(l)+u.getY(l),o.getZ(l)+u.getZ(l))}}}if(E){if(i.NORMAL!==undefined){var p=a[t];p.name=s;var c=d.attributes.normal;for(var l=0,f=p.count;l<f;l++){p.setXYZ(l,p.getX(l)+c.getX(l),p.getY(l)+c.getY(l),p.getZ(l)+c.getZ(l))}}}}if(h)d.morphAttributes.position=r;if(E)d.morphAttributes.normal=a;return d})}function D(e,r){e.updateMorphTargets();if(r.weights!==undefined){for(var a=0,t=r.weights.length;a<t;a++){e.morphTargetInfluences[a]=r.weights[a]}}if(r.extras&&Array.isArray(r.extras.targetNames)){var n=r.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(var a=0,t=n.length;a<t;a++){e.morphTargetDictionary[n[a]]=a}}else{console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}}function C(e,r){if(Object.keys(e).length!==Object.keys(r).length)return false;for(var a in e){if(e[a]!==r[a])return false}return true}function G(e){var r=e.extensions&&e.extensions[v.KHR_DRACO_MESH_COMPRESSION];var a;if(r){a="draco:"+r.bufferView+":"+r.indices+":"+B(r.attributes)}else{a=e.indices+":"+B(e.attributes)+":"+e.mode}return a}function B(e){var r="";var a=Object.keys(e).sort();for(var t=0,n=a.length;t<n;t++){r+=a[t]+":"+e[a[t]]+";"}return r}function k(e){if(e.isInterleavedBufferAttribute){var r=e.count;var a=e.itemSize;var t=e.array.slice(0,r*a);for(var n=0,i=0;n<r;++n){t[i++]=e.getX(n);if(a>=2)t[i++]=e.getY(n);if(a>=3)t[i++]=e.getZ(n);if(a>=4)t[i++]=e.getW(n)}return new THREE.BufferAttribute(t,a,e.normalized)}return e.clone()}function K(e,r,a){this.json=e||{};this.extensions=r||{};this.options=a||{};this.cache=new t;this.primitiveCache={};this.textureLoader=new THREE.TextureLoader(this.options.manager);this.textureLoader.setCrossOrigin(this.options.crossOrigin);this.fileLoader=new THREE.FileLoader(this.options.manager);this.fileLoader.setResponseType("arraybuffer")}K.prototype.parse=function(a,e){var t=this;var n=this.json;var i=this.extensions;this.cache.removeAll();this.markDefs();Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(e){var r={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:t,userData:{}};N(i,r,n);a(r)}).catch(e)};K.prototype.markDefs=function(){var e=this.json.nodes||[];var r=this.json.skins||[];var a=this.json.meshes||[];var t={};var n={};for(var i=0,s=r.length;i<s;i++){var o=r[i].joints;for(var u=0,l=o.length;u<l;u++){e[o[u]].isBone=true}}for(var f=0,p=e.length;f<p;f++){var c=e[f];if(c.mesh!==undefined){if(t[c.mesh]===undefined){t[c.mesh]=n[c.mesh]=0}t[c.mesh]++;if(c.skin!==undefined){a[c.mesh].isSkinnedMesh=true}}}this.json.meshReferences=t;this.json.meshUses=n};K.prototype.getDependency=function(e,r){var a=e+":"+r;var t=this.cache.get(a);if(!t){switch(e){case"scene":t=this.loadScene(r);break;case"node":t=this.loadNode(r);break;case"mesh":t=this.loadMesh(r);break;case"accessor":t=this.loadAccessor(r);break;case"bufferView":t=this.loadBufferView(r);break;case"buffer":t=this.loadBuffer(r);break;case"material":t=this.loadMaterial(r);break;case"texture":t=this.loadTexture(r);break;case"skin":t=this.loadSkin(r);break;case"animation":t=this.loadAnimation(r);break;case"camera":t=this.loadCamera(r);break;case"light":t=this.extensions[v.KHR_LIGHTS_PUNCTUAL].loadLight(r);break;default:throw new Error("Unknown type: "+e)}this.cache.add(a,t)}return t};K.prototype.getDependencies=function(a){var e=this.cache.get(a);if(!e){var t=this;var r=this.json[a+(a==="mesh"?"es":"s")]||[];e=Promise.all(r.map(function(e,r){return t.getDependency(a,r)}));this.cache.add(a,e)}return e};K.prototype.loadBuffer=function(e){var a=this.json.buffers[e];var t=this.fileLoader;if(a.type&&a.type!=="arraybuffer"){throw new Error("THREE.GLTFLoader: "+a.type+" buffer type is not supported.")}if(a.uri===undefined&&e===0){return Promise.resolve(this.extensions[v.KHR_BINARY_GLTF].body)}var n=this.options;return new Promise(function(e,r){t.load(F(a.uri,n.path),e,undefined,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+a.uri+'".'))})})};K.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var r=t.byteLength||0;var a=t.byteOffset||0;return e.slice(a,a+r)})};K.prototype.loadAccessor=function(e){var S=this;var L=this.json;var y=this.json.accessors[e];if(y.bufferView===undefined&&y.sparse===undefined){return Promise.resolve(null)}var r=[];if(y.bufferView!==undefined){r.push(this.getDependency("bufferView",y.bufferView))}else{r.push(null)}if(y.sparse!==undefined){r.push(this.getDependency("bufferView",y.sparse.indices.bufferView));r.push(this.getDependency("bufferView",y.sparse.values.bufferView))}return Promise.all(r).then(function(e){var r=e[0];var a=A[y.type];var t=H[y.componentType];var n=t.BYTES_PER_ELEMENT;var i=n*a;var s=y.byteOffset||0;var o=y.bufferView!==undefined?L.bufferViews[y.bufferView].byteStride:undefined;var u=y.normalized===true;var l,f;if(o&&o!==i){var p="InterleavedBuffer:"+y.bufferView+":"+y.componentType;var c=S.cache.get(p);if(!c){l=new t(r);c=new THREE.InterleavedBuffer(l,o/n);S.cache.add(p,c)}f=new THREE.InterleavedBufferAttribute(c,a,s/n,u)}else{if(r===null){l=new t(y.count*a)}else{l=new t(r,s,y.count*a)}f=new THREE.BufferAttribute(l,a,u)}if(y.sparse!==undefined){var d=A.SCALAR;var v=H[y.sparse.indices.componentType];var h=y.sparse.indices.byteOffset||0;var E=y.sparse.values.byteOffset||0;var m=new v(e[1],h,y.sparse.count*d);var T=new t(e[2],E,y.sparse.count*a);if(r!==null){f.setArray(f.array.slice())}for(var R=0,g=m.length;R<g;R++){var M=m[R];f.setX(M,T[R*a]);if(a>=2)f.setY(M,T[R*a+1]);if(a>=3)f.setZ(M,T[R*a+2]);if(a>=4)f.setW(M,T[R*a+3]);if(a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f})};K.prototype.loadTexture=function(e){var r=this;var t=this.json;var n=this.options;var i=this.textureLoader;var s=window.URL||window.webkitURL;var o=t.textures[e];var u=o.extensions||{};var l;if(u[v.MSFT_TEXTURE_DDS]){l=t.images[u[v.MSFT_TEXTURE_DDS].source]}else{l=t.images[o.source]}var f=l.uri;var p=false;if(l.bufferView!==undefined){f=r.getDependency("bufferView",l.bufferView).then(function(e){p=true;var r=new Blob([e],{type:l.mimeType});f=s.createObjectURL(r);return f})}return Promise.resolve(f).then(function(a){var t=THREE.Loader.Handlers.get(a);if(!t){t=u[v.MSFT_TEXTURE_DDS]?r.extensions[v.MSFT_TEXTURE_DDS].ddsLoader:i}return new Promise(function(e,r){t.load(F(a,n.path),e,undefined,r)})}).then(function(e){if(p===true){s.revokeObjectURL(f)}e.flipY=false;if(o.name!==undefined)e.name=o.name;if(l.mimeType in I){e.format=I[l.mimeType]}var r=t.samplers||{};var a=r[o.sampler]||{};e.magFilter=S[a.magFilter]||THREE.LinearFilter;e.minFilter=S[a.minFilter]||THREE.LinearMipMapLinearFilter;e.wrapS=L[a.wrapS]||THREE.RepeatWrapping;e.wrapT=L[a.wrapT]||THREE.RepeatWrapping;return e})};K.prototype.assignTexture=function(a,t,n){var i=this;return this.getDependency("texture",n.index).then(function(e){if(!e.isCompressedTexture){switch(t){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":e.format=THREE.RGBFormat;break}}if(i.extensions[v.KHR_TEXTURE_TRANSFORM]){var r=n.extensions!==undefined?n.extensions[v.KHR_TEXTURE_TRANSFORM]:undefined;if(r){e=i.extensions[v.KHR_TEXTURE_TRANSFORM].extendTexture(e,r)}}a[t]=e})};K.prototype.assignFinalMaterial=function(e){var r=e.geometry;var a=e.material;var t=this.extensions;var n=r.attributes.tangent!==undefined;var i=r.attributes.color!==undefined;var s=r.attributes.normal===undefined;var o=e.isSkinnedMesh===true;var u=Object.keys(r.morphAttributes).length>0;var l=u&&r.morphAttributes.normal!==undefined;if(e.isPoints){var f="PointsMaterial:"+a.uuid;var p=this.cache.get(f);if(!p){p=new THREE.PointsMaterial;THREE.Material.prototype.copy.call(p,a);p.color.copy(a.color);p.map=a.map;p.lights=false;this.cache.add(f,p)}a=p}else if(e.isLine){var f="LineBasicMaterial:"+a.uuid;var c=this.cache.get(f);if(!c){c=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(c,a);c.color.copy(a.color);c.lights=false;this.cache.add(f,c)}a=c}if(n||i||s||o||u){var f="ClonedMaterial:"+a.uuid+":";if(a.isGLTFSpecularGlossinessMaterial)f+="specular-glossiness:";if(o)f+="skinning:";if(n)f+="vertex-tangents:";if(i)f+="vertex-colors:";if(s)f+="flat-shading:";if(u)f+="morph-targets:";if(l)f+="morph-normals:";var d=this.cache.get(f);if(!d){d=a.isGLTFSpecularGlossinessMaterial?t[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(a):a.clone();if(o)d.skinning=true;if(n)d.vertexTangents=true;if(i)d.vertexColors=THREE.VertexColors;if(s)d.flatShading=true;if(u)d.morphTargets=true;if(l)d.morphNormals=true;this.cache.add(f,d)}a=d}if(a.aoMap&&r.attributes.uv2===undefined&&r.attributes.uv!==undefined){console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap.");r.addAttribute("uv2",new THREE.BufferAttribute(r.attributes.uv.array,2))}if(a.isGLTFSpecularGlossinessMaterial){e.onBeforeRender=t[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms}e.material=a};K.prototype.loadMaterial=function(e){var r=this;var a=this.json;var t=this.extensions;var n=a.materials[e];var i;var s={};var o=n.extensions||{};var u=[];if(o[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=t[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];i=l.getMaterialType();u.push(l.extendParams(s,n,r))}else if(o[v.KHR_MATERIALS_UNLIT]){var f=t[v.KHR_MATERIALS_UNLIT];i=f.getMaterialType();u.push(f.extendParams(s,n,r))}else{i=THREE.MeshStandardMaterial;var p=n.pbrMetallicRoughness||{};s.color=new THREE.Color(1,1,1);s.opacity=1;if(Array.isArray(p.baseColorFactor)){var c=p.baseColorFactor;s.color.fromArray(c);s.opacity=c[3]}if(p.baseColorTexture!==undefined){u.push(r.assignTexture(s,"map",p.baseColorTexture))}s.metalness=p.metallicFactor!==undefined?p.metallicFactor:1;s.roughness=p.roughnessFactor!==undefined?p.roughnessFactor:1;if(p.metallicRoughnessTexture!==undefined){u.push(r.assignTexture(s,"metalnessMap",p.metallicRoughnessTexture));u.push(r.assignTexture(s,"roughnessMap",p.metallicRoughnessTexture))}}if(n.doubleSided===true){s.side=THREE.DoubleSide}var d=n.alphaMode||b.OPAQUE;if(d===b.BLEND){s.transparent=true}else{s.transparent=false;if(d===b.MASK){s.alphaTest=n.alphaCutoff!==undefined?n.alphaCutoff:.5}}if(n.normalTexture!==undefined&&i!==THREE.MeshBasicMaterial){u.push(r.assignTexture(s,"normalMap",n.normalTexture));s.normalScale=new THREE.Vector2(1,1);if(n.normalTexture.scale!==undefined){s.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)}}if(n.occlusionTexture!==undefined&&i!==THREE.MeshBasicMaterial){u.push(r.assignTexture(s,"aoMap",n.occlusionTexture));if(n.occlusionTexture.strength!==undefined){s.aoMapIntensity=n.occlusionTexture.strength}}if(n.emissiveFactor!==undefined&&i!==THREE.MeshBasicMaterial){s.emissive=(new THREE.Color).fromArray(n.emissiveFactor)}if(n.emissiveTexture!==undefined&&i!==THREE.MeshBasicMaterial){u.push(r.assignTexture(s,"emissiveMap",n.emissiveTexture))}return Promise.all(u).then(function(){var e;if(i===THREE.ShaderMaterial){e=t[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s)}else{e=new i(s)}if(n.name!==undefined)e.name=n.name;if(e.map)e.map.encoding=THREE.sRGBEncoding;if(e.emissiveMap)e.emissiveMap.encoding=THREE.sRGBEncoding;if(e.specularMap)e.specularMap.encoding=THREE.sRGBEncoding;O(e,n);if(n.extensions)N(t,e,n);return e})};function j(a,e,t){var r=e.attributes;var n=[];function i(e,r){return t.getDependency("accessor",e).then(function(e){a.addAttribute(r,e)})}for(var s in r){var o=_[s]||s.toLowerCase();if(o in a.attributes)continue;n.push(i(r[s],o))}if(e.indices!==undefined&&!a.index){var u=t.getDependency("accessor",e.indices).then(function(e){a.setIndex(e)});n.push(u)}O(a,e);return Promise.all(n).then(function(){return e.targets!==undefined?U(a,e.targets,t):a})}K.prototype.loadGeometries=function(e){var a=this;var t=this.extensions;var r=this.primitiveCache;function n(r){return t[v.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,a).then(function(e){return j(e,r,a)})}var i=[];for(var s=0,o=e.length;s<o;s++){var u=e[s];var l=G(u);var f=r[l];if(f){i.push(f.promise)}else{var p;if(u.extensions&&u.extensions[v.KHR_DRACO_MESH_COMPRESSION]){p=n(u)}else{p=j(new THREE.BufferGeometry,u,a)}r[l]={primitive:u,promise:p};i.push(p)}}return Promise.all(i)};K.prototype.loadMesh=function(f){var p=this;var e=this.json;var r=this.extensions;var c=e.meshes[f];var d=c.primitives;var a=[];for(var t=0,n=d.length;t<n;t++){var i=d[t].material===undefined?P():this.getDependency("material",d[t].material);a.push(i)}return Promise.all(a).then(function(l){return p.loadGeometries(d).then(function(e){var r=[];for(var a=0,t=e.length;a<t;a++){var n=e[a];var i=d[a];var s;var o=l[a];if(i.mode===M.TRIANGLES||i.mode===M.TRIANGLE_STRIP||i.mode===M.TRIANGLE_FAN||i.mode===undefined){s=c.isSkinnedMesh===true?new THREE.SkinnedMesh(n,o):new THREE.Mesh(n,o);if(s.isSkinnedMesh===true)s.normalizeSkinWeights();if(i.mode===M.TRIANGLE_STRIP){s.drawMode=THREE.TriangleStripDrawMode}else if(i.mode===M.TRIANGLE_FAN){s.drawMode=THREE.TriangleFanDrawMode}}else if(i.mode===M.LINES){s=new THREE.LineSegments(n,o)}else if(i.mode===M.LINE_STRIP){s=new THREE.Line(n,o)}else if(i.mode===M.LINE_LOOP){s=new THREE.LineLoop(n,o)}else if(i.mode===M.POINTS){s=new THREE.Points(n,o)}else{throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+i.mode)}if(Object.keys(s.geometry.morphAttributes).length>0){D(s,c)}s.name=c.name||"mesh_"+f;if(e.length>1)s.name+="_"+a;O(s,c);p.assignFinalMaterial(s);r.push(s)}if(r.length===1){return r[0]}var u=new THREE.Group;for(var a=0,t=r.length;a<t;a++){u.add(r[a])}return u})})};K.prototype.loadCamera=function(e){var r;var a=this.json.cameras[e];var t=a[a.type];if(!t){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}if(a.type==="perspective"){r=new THREE.PerspectiveCamera(THREE.Math.radToDeg(t.yfov),t.aspectRatio||1,t.znear||1,t.zfar||2e6)}else if(a.type==="orthographic"){r=new THREE.OrthographicCamera(t.xmag/-2,t.xmag/2,t.ymag/2,t.ymag/-2,t.znear,t.zfar)}if(a.name!==undefined)r.name=a.name;O(r,a);return Promise.resolve(r)};K.prototype.loadSkin=function(e){var r=this.json.skins[e];var a={joints:r.joints};if(r.inverseBindMatrices===undefined){return Promise.resolve(a)}return this.getDependency("accessor",r.inverseBindMatrices).then(function(e){a.inverseBindMatrices=e;return a})};K.prototype.loadAnimation=function(S){var e=this.json;var L=e.animations[S];var r=[];var a=[];var t=[];var n=[];var i=[];for(var s=0,o=L.channels.length;s<o;s++){var u=L.channels[s];var l=L.samplers[u.sampler];var f=u.target;var p=f.node!==undefined?f.node:f.id;var c=L.parameters!==undefined?L.parameters[l.input]:l.input;var d=L.parameters!==undefined?L.parameters[l.output]:l.output;r.push(this.getDependency("node",p));a.push(this.getDependency("accessor",c));t.push(this.getDependency("accessor",d));n.push(l);i.push(f)}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(t),Promise.all(n),Promise.all(i)]).then(function(e){var r=e[0];var a=e[1];var t=e[2];var n=e[3];var i=e[4];var s=[];for(var o=0,u=r.length;o<u;o++){var l=r[o];var f=a[o];var p=t[o];var c=n[o];var d=i[o];if(l===undefined)continue;l.updateMatrix();l.matrixAutoUpdate=true;var v;switch(x[d.path]){case x.weights:v=THREE.NumberKeyframeTrack;break;case x.rotation:v=THREE.QuaternionKeyframeTrack;break;case x.position:case x.scale:default:v=THREE.VectorKeyframeTrack;break}var h=l.name?l.name:l.uuid;var E=c.interpolation!==undefined?w[c.interpolation]:THREE.InterpolateLinear;var m=[];if(x[d.path]===x.weights){l.traverse(function(e){if(e.isMesh===true&&e.morphTargetInfluences){m.push(e.name?e.name:e.uuid)}})}else{m.push(h)}for(var T=0,R=m.length;T<R;T++){var g=new v(m[T]+"."+x[d.path],f.array,p.array,E);if(c.interpolation==="CUBICSPLINE"){g.createInterpolant=function e(r){return new y(this.times,this.values,this.getValueSize()/3,r)};g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=true}s.push(g)}}var M=L.name!==undefined?L.name:"animation_"+S;return new THREE.AnimationClip(M,undefined,s)})};K.prototype.loadNode=function(e){var r=this.json;var a=this.extensions;var t=this;var i=r.meshReferences;var s=r.meshUses;var o=r.nodes[e];return function(){if(o.isBone===true){return Promise.resolve(new THREE.Bone)}else if(o.mesh!==undefined){return t.getDependency("mesh",o.mesh).then(function(e){var r;if(i[o.mesh]>1){var a=s[o.mesh]++;r=e.clone();r.name+="_instance_"+a;r.onBeforeRender=e.onBeforeRender;for(var t=0,n=r.children.length;t<n;t++){r.children[t].name+="_instance_"+a;r.children[t].onBeforeRender=e.children[t].onBeforeRender}}else{r=e}if(o.weights!==undefined){r.traverse(function(e){if(!e.isMesh)return;for(var r=0,a=o.weights.length;r<a;r++){e.morphTargetInfluences[r]=o.weights[r]}})}return r})}else if(o.camera!==undefined){return t.getDependency("camera",o.camera)}else if(o.extensions&&o.extensions[v.KHR_LIGHTS_PUNCTUAL]&&o.extensions[v.KHR_LIGHTS_PUNCTUAL].light!==undefined){return t.getDependency("light",o.extensions[v.KHR_LIGHTS_PUNCTUAL].light)}else{return Promise.resolve(new THREE.Object3D)}}().then(function(e){if(o.name!==undefined){e.name=THREE.PropertyBinding.sanitizeNodeName(o.name)}O(e,o);if(o.extensions)N(a,e,o);if(o.matrix!==undefined){var r=new THREE.Matrix4;r.fromArray(o.matrix);e.applyMatrix(r)}else{if(o.translation!==undefined){e.position.fromArray(o.translation)}if(o.rotation!==undefined){e.quaternion.fromArray(o.rotation)}if(o.scale!==undefined){e.scale.fromArray(o.scale)}}return e})};K.prototype.loadScene=function(){function p(e,s,o,u){var l=o.nodes[e];return u.getDependency("node",e).then(function(p){if(l.skin===undefined)return p;var c;return u.getDependency("skin",l.skin).then(function(e){c=e;var r=[];for(var a=0,t=c.joints.length;a<t;a++){r.push(u.getDependency("node",c.joints[a]))}return Promise.all(r)}).then(function(e){var r=p.isGroup===true?p.children:[p];for(var a=0,t=r.length;a<t;a++){var n=r[a];var i=[];var s=[];for(var o=0,u=e.length;o<u;o++){var l=e[o];if(l){i.push(l);var f=new THREE.Matrix4;if(c.inverseBindMatrices!==undefined){f.fromArray(c.inverseBindMatrices.array,o*16)}s.push(f)}else{console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',c.joints[o])}}n.bind(new THREE.Skeleton(i,s),n.matrixWorld)}return p})}).then(function(e){s.add(e);var r=[];if(l.children){var a=l.children;for(var t=0,n=a.length;t<n;t++){var i=a[t];r.push(p(i,e,o,u))}}return Promise.all(r)})}return function e(r){var a=this.json;var t=this.extensions;var n=this.json.scenes[r];var i=this;var s=new THREE.Scene;if(n.name!==undefined)s.name=n.name;O(s,n);if(n.extensions)N(t,s,n);var o=n.nodes||[];var u=[];for(var l=0,f=o.length;l<f;l++){u.push(p(o[l],s,a,i))}return Promise.all(u).then(function(){return s})}}();return e}();
//# sourceMappingURL=GLTFLoader.min.js.map