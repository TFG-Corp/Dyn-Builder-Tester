THREE.GLTFLoader=function(){function e(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager;this.dracoLoader=null}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(e,r,a,t){var n=this;var i;if(this.resourcePath!==undefined){i=this.resourcePath}else if(this.path!==undefined){i=this.path}else{i=THREE.LoaderUtils.extractUrlBase(e)}n.manager.itemStart(e);var s=function(r){if(t){t(r)}else{console.error(r)}n.manager.itemError(e);n.manager.itemEnd(e)};var o=new THREE.FileLoader(n.manager);o.setPath(this.path);o.setResponseType("arraybuffer");o.load(e,function(a){try{n.parse(a,i,function(a){r(a);n.manager.itemEnd(e)},s)}catch(a){s(a)}},a,s)},setCrossOrigin:function(e){this.crossOrigin=e;return this},setPath:function(e){this.path=e;return this},setResourcePath:function(e){this.resourcePath=e;return this},setDRACOLoader:function(e){this.dracoLoader=e;return this},parse:function(e,r,s,u){var l;var v={};if(typeof e==="string"){l=e}else{var h=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4));if(h===o){try{v[a.KHR_BINARY_GLTF]=new f(e)}catch(e){if(u)u(e);return}l=v[a.KHR_BINARY_GLTF].content}else{l=THREE.LoaderUtils.decodeText(new Uint8Array(e))}}var E=JSON.parse(l);if(E.asset===undefined||E.asset.version[0]<2){if(u)u(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));return}if(E.extensionsUsed){for(var m=0;m<E.extensionsUsed.length;++m){var T=E.extensionsUsed[m];var R=E.extensionsRequired||[];switch(T){case a.KHR_LIGHTS_PUNCTUAL:v[T]=new n(E);break;case a.KHR_MATERIALS_UNLIT:v[T]=new i(E);break;case a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:v[T]=new d(E);break;case a.KHR_DRACO_MESH_COMPRESSION:v[T]=new p(E,this.dracoLoader);break;case a.MSFT_TEXTURE_DDS:v[a.MSFT_TEXTURE_DDS]=new t;break;case a.KHR_TEXTURE_TRANSFORM:v[a.KHR_TEXTURE_TRANSFORM]=new c(E);break;default:if(R.indexOf(T)>=0){console.warn('THREE.GLTFLoader: Unknown extension "'+T+'".')}}}}var g=new K(E,v,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});g.parse(s,u)}};function r(){var e={};return{get:function(r){return e[r]},add:function(r,a){e[r]=a},remove:function(r){delete e[r]},removeAll:function(){e={}}}}var a={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function t(){if(!THREE.DDSLoader){throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader")}this.name=a.MSFT_TEXTURE_DDS;this.ddsLoader=new THREE.DDSLoader}function n(e){this.name=a.KHR_LIGHTS_PUNCTUAL;var r=e.extensions&&e.extensions[a.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=r.lights||[]}n.prototype.loadLight=function(e){var r=this.lightDefs[e];var a;var t=new THREE.Color(16777215);if(r.color!==undefined)t.fromArray(r.color);var n=r.range!==undefined?r.range:0;switch(r.type){case"directional":a=new THREE.DirectionalLight(t);a.target.position.set(0,0,-1);a.add(a.target);break;case"point":a=new THREE.PointLight(t);a.distance=n;break;case"spot":a=new THREE.SpotLight(t);a.distance=n;r.spot=r.spot||{};r.spot.innerConeAngle=r.spot.innerConeAngle!==undefined?r.spot.innerConeAngle:0;r.spot.outerConeAngle=r.spot.outerConeAngle!==undefined?r.spot.outerConeAngle:Math.PI/4;a.angle=r.spot.outerConeAngle;a.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle;a.target.position.set(0,0,-1);a.add(a.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}a.position.set(0,0,0);a.decay=2;if(r.intensity!==undefined)a.intensity=r.intensity;a.name=r.name||"light_"+e;return Promise.resolve(a)};function i(){this.name=a.KHR_MATERIALS_UNLIT}i.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial};i.prototype.extendParams=function(e,r,a){var t=[];e.color=new THREE.Color(1,1,1);e.opacity=1;var n=r.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var i=n.baseColorFactor;e.color.fromArray(i);e.opacity=i[3]}if(n.baseColorTexture!==undefined){t.push(a.assignTexture(e,"map",n.baseColorTexture))}}return Promise.all(t)};var s="binary_glTF";var o="glTF";var u=12;var l={JSON:1313821514,BIN:5130562};function f(e){this.name=a.KHR_BINARY_GLTF;this.content=null;this.body=null;var r=new DataView(e,0,u);this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,true),length:r.getUint32(8,true)};if(this.header.magic!==o){throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.")}else if(this.header.version<2){throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.")}var t=new DataView(e,u);var n=0;while(n<t.byteLength){var i=t.getUint32(n,true);n+=4;var s=t.getUint32(n,true);n+=4;if(s===l.JSON){var f=new Uint8Array(e,u+n,i);this.content=THREE.LoaderUtils.decodeText(f)}else if(s===l.BIN){var p=u+n;this.body=e.slice(p,p+i)}n+=i}if(this.content===null){throw new Error("THREE.GLTFLoader: JSON content not found.")}}function p(e,r){if(!r){throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.")}this.name=a.KHR_DRACO_MESH_COMPRESSION;this.json=e;this.dracoLoader=r}p.prototype.decodePrimitive=function(e,r){var a=this.json;var t=this.dracoLoader;var n=e.extensions[this.name].bufferView;var i=e.extensions[this.name].attributes;var s={};var o={};var u={};for(var l in i){var f=H[l]||l.toLowerCase();s[f]=i[l]}for(l in e.attributes){var f=H[l]||l.toLowerCase();if(i[l]!==undefined){var p=a.accessors[e.attributes[l]];var c=m[p.componentType];u[f]=c;o[f]=p.normalized===true}}return r.getDependency("bufferView",n).then(function(e){return new Promise(function(r){t.decodeDracoFile(e,function(e){for(var a in e.attributes){var t=e.attributes[a];var n=o[a];if(n!==undefined)t.normalized=n}r(e)},s,u)})})};function c(){this.name=a.KHR_TEXTURE_TRANSFORM}c.prototype.extendTexture=function(e,r){e=e.clone();if(r.offset!==undefined){e.offset.fromArray(r.offset)}if(r.rotation!==undefined){e.rotation=r.rotation}if(r.scale!==undefined){e.repeat.fromArray(r.scale)}if(r.texCoord!==undefined){console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.')}e.needsUpdate=true;return e};function d(){return{name:a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,r,a){var t=r.extensions[this.name];var n=THREE.ShaderLib["standard"];var i=THREE.UniformsUtils.clone(n.uniforms);var s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n");var o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n");var u=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n");var l=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n");var f=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n");var p=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",u).replace("#include <metalnessmap_fragment>",l).replace("#include <lights_physical_fragment>",f);delete i.roughness;delete i.metalness;delete i.roughnessMap;delete i.metalnessMap;i.specular={value:(new THREE.Color).setHex(1118481)};i.glossiness={value:.5};i.specularMap={value:null};i.glossinessMap={value:null};e.vertexShader=n.vertexShader;e.fragmentShader=p;e.uniforms=i;e.defines={STANDARD:""};e.color=new THREE.Color(1,1,1);e.opacity=1;var c=[];if(Array.isArray(t.diffuseFactor)){var d=t.diffuseFactor;e.color.fromArray(d);e.opacity=d[3]}if(t.diffuseTexture!==undefined){c.push(a.assignTexture(e,"map",t.diffuseTexture))}e.emissive=new THREE.Color(0,0,0);e.glossiness=t.glossinessFactor!==undefined?t.glossinessFactor:1;e.specular=new THREE.Color(1,1,1);if(Array.isArray(t.specularFactor)){e.specular.fromArray(t.specularFactor)}if(t.specularGlossinessTexture!==undefined){var v=t.specularGlossinessTexture;c.push(a.assignTexture(e,"glossinessMap",v));c.push(a.assignTexture(e,"specularMap",v))}return Promise.all(c)},createMaterial:function(e){var r=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:true,lights:true,opacity:e.opacity,transparent:e.transparent});r.isGLTFSpecularGlossinessMaterial=true;r.color=e.color;r.map=e.map===undefined?null:e.map;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=e.aoMap===undefined?null:e.aoMap;r.aoMapIntensity=1;r.emissive=e.emissive;r.emissiveIntensity=1;r.emissiveMap=e.emissiveMap===undefined?null:e.emissiveMap;r.bumpMap=e.bumpMap===undefined?null:e.bumpMap;r.bumpScale=1;r.normalMap=e.normalMap===undefined?null:e.normalMap;if(e.normalScale)r.normalScale=e.normalScale;r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.specularMap=e.specularMap===undefined?null:e.specularMap;r.specular=e.specular;r.glossinessMap=e.glossinessMap===undefined?null:e.glossinessMap;r.glossiness=e.glossiness;r.alphaMap=null;r.envMap=e.envMap===undefined?null:e.envMap;r.envMapIntensity=1;r.refractionRatio=.98;r.extensions.derivatives=true;return r},cloneMaterial:function(e){var r=e.clone();r.isGLTFSpecularGlossinessMaterial=true;var a=this.specularGlossinessParams;for(var t=0,n=a.length;t<n;t++){r[a[t]]=e[a[t]]}return r},refreshUniforms:function(e,r,a,t,n,i){if(n.isGLTFSpecularGlossinessMaterial!==true){return}var s=n.uniforms;var o=n.defines;s.opacity.value=n.opacity;s.diffuse.value.copy(n.color);s.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity);s.map.value=n.map;s.specularMap.value=n.specularMap;s.alphaMap.value=n.alphaMap;s.lightMap.value=n.lightMap;s.lightMapIntensity.value=n.lightMapIntensity;s.aoMap.value=n.aoMap;s.aoMapIntensity.value=n.aoMapIntensity;var u;if(n.map){u=n.map}else if(n.specularMap){u=n.specularMap}else if(n.displacementMap){u=n.displacementMap}else if(n.normalMap){u=n.normalMap}else if(n.bumpMap){u=n.bumpMap}else if(n.glossinessMap){u=n.glossinessMap}else if(n.alphaMap){u=n.alphaMap}else if(n.emissiveMap){u=n.emissiveMap}if(u!==undefined){if(u.isWebGLRenderTarget){u=u.texture}if(u.matrixAutoUpdate===true){u.updateMatrix()}s.uvTransform.value.copy(u.matrix)}if(n.envMap){s.envMap.value=n.envMap;s.envMapIntensity.value=n.envMapIntensity;s.flipEnvMap.value=n.envMap.isCubeTexture?-1:1;s.reflectivity.value=n.reflectivity;s.refractionRatio.value=n.refractionRatio;s.maxMipLevel.value=e.properties.get(n.envMap).__maxMipLevel}s.specular.value.copy(n.specular);s.glossiness.value=n.glossiness;s.glossinessMap.value=n.glossinessMap;s.emissiveMap.value=n.emissiveMap;s.bumpMap.value=n.bumpMap;s.normalMap.value=n.normalMap;s.displacementMap.value=n.displacementMap;s.displacementScale.value=n.displacementScale;s.displacementBias.value=n.displacementBias;if(s.glossinessMap.value!==null&&o.USE_GLOSSINESSMAP===undefined){o.USE_GLOSSINESSMAP="";o.USE_ROUGHNESSMAP=""}if(s.glossinessMap.value===null&&o.USE_GLOSSINESSMAP!==undefined){delete o.USE_GLOSSINESSMAP;delete o.USE_ROUGHNESSMAP}}}}function v(e,r,a,t){THREE.Interpolant.call(this,e,r,a,t)}v.prototype=Object.create(THREE.Interpolant.prototype);v.prototype.constructor=v;v.prototype.copySampleValue_=function(e){var r=this.resultBuffer,a=this.sampleValues,t=this.valueSize,n=e*t*3+t;for(var i=0;i!==t;i++){r[i]=a[n+i]}return r};v.prototype.beforeStart_=v.prototype.copySampleValue_;v.prototype.afterEnd_=v.prototype.copySampleValue_;v.prototype.interpolate_=function(e,r,a,t){var n=this.resultBuffer;var i=this.sampleValues;var s=this.valueSize;var o=s*2;var u=s*3;var l=t-r;var f=(a-r)/l;var p=f*f;var c=p*f;var d=e*u;var v=d-u;var h=-2*c+3*p;var E=c-p;var m=1-h;var T=E-p+f;for(var R=0;R!==s;R++){var g=i[v+R+s];var M=i[v+R+o]*l;var S=i[d+R+s];var L=i[d+R]*l;n[R]=m*g+T*M+h*S+E*L}return n};var h={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123};var E={5126:Number,35675:THREE.Matrix3,35676:THREE.Matrix4,35664:THREE.Vector2,35665:THREE.Vector3,35666:THREE.Vector4,35678:THREE.Texture};var m={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var T={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter};var R={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping};var g={1028:THREE.BackSide,1029:THREE.FrontSide};var M={512:THREE.NeverDepth,513:THREE.LessDepth,514:THREE.EqualDepth,515:THREE.LessEqualDepth,516:THREE.GreaterEqualDepth,517:THREE.NotEqualDepth,518:THREE.GreaterEqualDepth,519:THREE.AlwaysDepth};var S={32774:THREE.AddEquation,32778:THREE.SubtractEquation,32779:THREE.ReverseSubtractEquation};var L={0:THREE.ZeroFactor,1:THREE.OneFactor,768:THREE.SrcColorFactor,769:THREE.OneMinusSrcColorFactor,770:THREE.SrcAlphaFactor,771:THREE.OneMinusSrcAlphaFactor,772:THREE.DstAlphaFactor,773:THREE.OneMinusDstAlphaFactor,774:THREE.DstColorFactor,775:THREE.OneMinusDstColorFactor,776:THREE.SrcAlphaSaturateFactor};var y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};var H={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"};var A={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"};var _={CUBICSPLINE:undefined,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete};var x={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};var w={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};var b={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function I(e,r){if(typeof e!=="string"||e==="")return"";if(/^(https?:)?\/\//i.test(e))return e;if(/^data:.*,.*$/i.test(e))return e;if(/^blob:.*$/i.test(e))return e;return r+e}var F;function P(){F=F||new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:false,depthTest:true,side:THREE.FrontSide});return F}function N(e,r,a){for(var t in a.extensions){if(e[t]===undefined){r.userData.gltfExtensions=r.userData.gltfExtensions||{};r.userData.gltfExtensions[t]=a.extensions[t]}}}function O(e,r){if(r.extras!==undefined){if(typeof r.extras==="object"){e.userData=r.extras}else{console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+r.extras)}}}function U(e,r,a){var t=false;var n=false;for(var i=0,s=r.length;i<s;i++){var o=r[i];if(o.POSITION!==undefined)t=true;if(o.NORMAL!==undefined)n=true;if(t&&n)break}if(!t&&!n)return Promise.resolve(e);var u=[];var l=[];for(var i=0,s=r.length;i<s;i++){var o=r[i];if(t){var f=o.POSITION!==undefined?a.getDependency("accessor",o.POSITION):e.attributes.position;u.push(f)}if(n){var f=o.NORMAL!==undefined?a.getDependency("accessor",o.NORMAL):e.attributes.normal;l.push(f)}}return Promise.all([Promise.all(u),Promise.all(l)]).then(function(a){var i=a[0];var s=a[1];for(var o=0,u=i.length;o<u;o++){if(e.attributes.position===i[o])continue;i[o]=k(i[o])}for(var o=0,u=s.length;o<u;o++){if(e.attributes.normal===s[o])continue;s[o]=k(s[o])}for(var o=0,u=r.length;o<u;o++){var l=r[o];var f="morphTarget"+o;if(t){if(l.POSITION!==undefined){var p=i[o];p.name=f;var c=e.attributes.position;for(var d=0,v=p.count;d<v;d++){p.setXYZ(d,p.getX(d)+c.getX(d),p.getY(d)+c.getY(d),p.getZ(d)+c.getZ(d))}}}if(n){if(l.NORMAL!==undefined){var h=s[o];h.name=f;var E=e.attributes.normal;for(var d=0,v=h.count;d<v;d++){h.setXYZ(d,h.getX(d)+E.getX(d),h.getY(d)+E.getY(d),h.getZ(d)+E.getZ(d))}}}}if(t)e.morphAttributes.position=i;if(n)e.morphAttributes.normal=s;return e})}function D(e,r){e.updateMorphTargets();if(r.weights!==undefined){for(var a=0,t=r.weights.length;a<t;a++){e.morphTargetInfluences[a]=r.weights[a]}}if(r.extras&&Array.isArray(r.extras.targetNames)){var n=r.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(var a=0,t=n.length;a<t;a++){e.morphTargetDictionary[n[a]]=a}}else{console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}}function C(e,r){if(Object.keys(e).length!==Object.keys(r).length)return false;for(var a in e){if(e[a]!==r[a])return false}return true}function G(e){var r=e.extensions&&e.extensions[a.KHR_DRACO_MESH_COMPRESSION];var t;if(r){t="draco:"+r.bufferView+":"+r.indices+":"+B(r.attributes)}else{t=e.indices+":"+B(e.attributes)+":"+e.mode}return t}function B(e){var r="";var a=Object.keys(e).sort();for(var t=0,n=a.length;t<n;t++){r+=a[t]+":"+e[a[t]]+";"}return r}function k(e){if(e.isInterleavedBufferAttribute){var r=e.count;var a=e.itemSize;var t=e.array.slice(0,r*a);for(var n=0,i=0;n<r;++n){t[i++]=e.getX(n);if(a>=2)t[i++]=e.getY(n);if(a>=3)t[i++]=e.getZ(n);if(a>=4)t[i++]=e.getW(n)}return new THREE.BufferAttribute(t,a,e.normalized)}return e.clone()}function K(e,a,t){this.json=e||{};this.extensions=a||{};this.options=t||{};this.cache=new r;this.primitiveCache={};this.textureLoader=new THREE.TextureLoader(this.options.manager);this.textureLoader.setCrossOrigin(this.options.crossOrigin);this.fileLoader=new THREE.FileLoader(this.options.manager);this.fileLoader.setResponseType("arraybuffer")}K.prototype.parse=function(e,r){var a=this;var t=this.json;var n=this.extensions;this.cache.removeAll();this.markDefs();Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(r){var i={scene:r[0][t.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:t.asset,parser:a,userData:{}};N(n,i,t);e(i)}).catch(r)};K.prototype.markDefs=function(){var e=this.json.nodes||[];var r=this.json.skins||[];var a=this.json.meshes||[];var t={};var n={};for(var i=0,s=r.length;i<s;i++){var o=r[i].joints;for(var u=0,l=o.length;u<l;u++){e[o[u]].isBone=true}}for(var f=0,p=e.length;f<p;f++){var c=e[f];if(c.mesh!==undefined){if(t[c.mesh]===undefined){t[c.mesh]=n[c.mesh]=0}t[c.mesh]++;if(c.skin!==undefined){a[c.mesh].isSkinnedMesh=true}}}this.json.meshReferences=t;this.json.meshUses=n};K.prototype.getDependency=function(e,r){var t=e+":"+r;var n=this.cache.get(t);if(!n){switch(e){case"scene":n=this.loadScene(r);break;case"node":n=this.loadNode(r);break;case"mesh":n=this.loadMesh(r);break;case"accessor":n=this.loadAccessor(r);break;case"bufferView":n=this.loadBufferView(r);break;case"buffer":n=this.loadBuffer(r);break;case"material":n=this.loadMaterial(r);break;case"texture":n=this.loadTexture(r);break;case"skin":n=this.loadSkin(r);break;case"animation":n=this.loadAnimation(r);break;case"camera":n=this.loadCamera(r);break;case"light":n=this.extensions[a.KHR_LIGHTS_PUNCTUAL].loadLight(r);break;default:throw new Error("Unknown type: "+e)}this.cache.add(t,n)}return n};K.prototype.getDependencies=function(e){var r=this.cache.get(e);if(!r){var a=this;var t=this.json[e+(e==="mesh"?"es":"s")]||[];r=Promise.all(t.map(function(r,t){return a.getDependency(e,t)}));this.cache.add(e,r)}return r};K.prototype.loadBuffer=function(e){var r=this.json.buffers[e];var t=this.fileLoader;if(r.type&&r.type!=="arraybuffer"){throw new Error("THREE.GLTFLoader: "+r.type+" buffer type is not supported.")}if(r.uri===undefined&&e===0){return Promise.resolve(this.extensions[a.KHR_BINARY_GLTF].body)}var n=this.options;return new Promise(function(e,a){t.load(I(r.uri,n.path),e,undefined,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+r.uri+'".'))})})};K.prototype.loadBufferView=function(e){var r=this.json.bufferViews[e];return this.getDependency("buffer",r.buffer).then(function(e){var a=r.byteLength||0;var t=r.byteOffset||0;return e.slice(t,t+a)})};K.prototype.loadAccessor=function(e){var r=this;var a=this.json;var t=this.json.accessors[e];if(t.bufferView===undefined&&t.sparse===undefined){return Promise.resolve(null)}var n=[];if(t.bufferView!==undefined){n.push(this.getDependency("bufferView",t.bufferView))}else{n.push(null)}if(t.sparse!==undefined){n.push(this.getDependency("bufferView",t.sparse.indices.bufferView));n.push(this.getDependency("bufferView",t.sparse.values.bufferView))}return Promise.all(n).then(function(e){var n=e[0];var i=y[t.type];var s=m[t.componentType];var o=s.BYTES_PER_ELEMENT;var u=o*i;var l=t.byteOffset||0;var f=t.bufferView!==undefined?a.bufferViews[t.bufferView].byteStride:undefined;var p=t.normalized===true;var c,d;if(f&&f!==u){var v="InterleavedBuffer:"+t.bufferView+":"+t.componentType;var h=r.cache.get(v);if(!h){c=new s(n);h=new THREE.InterleavedBuffer(c,f/o);r.cache.add(v,h)}d=new THREE.InterleavedBufferAttribute(h,i,l/o,p)}else{if(n===null){c=new s(t.count*i)}else{c=new s(n,l,t.count*i)}d=new THREE.BufferAttribute(c,i,p)}if(t.sparse!==undefined){var E=y.SCALAR;var T=m[t.sparse.indices.componentType];var R=t.sparse.indices.byteOffset||0;var g=t.sparse.values.byteOffset||0;var M=new T(e[1],R,t.sparse.count*E);var S=new s(e[2],g,t.sparse.count*i);if(n!==null){d.setArray(d.array.slice())}for(var L=0,H=M.length;L<H;L++){var A=M[L];d.setX(A,S[L*i]);if(i>=2)d.setY(A,S[L*i+1]);if(i>=3)d.setZ(A,S[L*i+2]);if(i>=4)d.setW(A,S[L*i+3]);if(i>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d})};K.prototype.loadTexture=function(e){var r=this;var t=this.json;var n=this.options;var i=this.textureLoader;var s=window.URL||window.webkitURL;var o=t.textures[e];var u=o.extensions||{};var l;if(u[a.MSFT_TEXTURE_DDS]){l=t.images[u[a.MSFT_TEXTURE_DDS].source]}else{l=t.images[o.source]}var f=l.uri;var p=false;if(l.bufferView!==undefined){f=r.getDependency("bufferView",l.bufferView).then(function(e){p=true;var r=new Blob([e],{type:l.mimeType});f=s.createObjectURL(r);return f})}return Promise.resolve(f).then(function(e){var t=THREE.Loader.Handlers.get(e);if(!t){t=u[a.MSFT_TEXTURE_DDS]?r.extensions[a.MSFT_TEXTURE_DDS].ddsLoader:i}return new Promise(function(r,a){t.load(I(e,n.path),r,undefined,a)})}).then(function(e){if(p===true){s.revokeObjectURL(f)}e.flipY=false;if(o.name!==undefined)e.name=o.name;if(l.mimeType in b){e.format=b[l.mimeType]}var r=t.samplers||{};var a=r[o.sampler]||{};e.magFilter=T[a.magFilter]||THREE.LinearFilter;e.minFilter=T[a.minFilter]||THREE.LinearMipMapLinearFilter;e.wrapS=R[a.wrapS]||THREE.RepeatWrapping;e.wrapT=R[a.wrapT]||THREE.RepeatWrapping;return e})};K.prototype.assignTexture=function(e,r,t){var n=this;return this.getDependency("texture",t.index).then(function(i){if(!i.isCompressedTexture){switch(r){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":i.format=THREE.RGBFormat;break}}if(n.extensions[a.KHR_TEXTURE_TRANSFORM]){var s=t.extensions!==undefined?t.extensions[a.KHR_TEXTURE_TRANSFORM]:undefined;if(s){i=n.extensions[a.KHR_TEXTURE_TRANSFORM].extendTexture(i,s)}}e[r]=i})};K.prototype.assignFinalMaterial=function(e){var r=e.geometry;var t=e.material;var n=this.extensions;var i=r.attributes.tangent!==undefined;var s=r.attributes.color!==undefined;var o=r.attributes.normal===undefined;var u=e.isSkinnedMesh===true;var l=Object.keys(r.morphAttributes).length>0;var f=l&&r.morphAttributes.normal!==undefined;if(e.isPoints){var p="PointsMaterial:"+t.uuid;var c=this.cache.get(p);if(!c){c=new THREE.PointsMaterial;THREE.Material.prototype.copy.call(c,t);c.color.copy(t.color);c.map=t.map;c.lights=false;this.cache.add(p,c)}t=c}else if(e.isLine){var p="LineBasicMaterial:"+t.uuid;var d=this.cache.get(p);if(!d){d=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(d,t);d.color.copy(t.color);d.lights=false;this.cache.add(p,d)}t=d}if(i||s||o||u||l){var p="ClonedMaterial:"+t.uuid+":";if(t.isGLTFSpecularGlossinessMaterial)p+="specular-glossiness:";if(u)p+="skinning:";if(i)p+="vertex-tangents:";if(s)p+="vertex-colors:";if(o)p+="flat-shading:";if(l)p+="morph-targets:";if(f)p+="morph-normals:";var v=this.cache.get(p);if(!v){v=t.isGLTFSpecularGlossinessMaterial?n[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(t):t.clone();if(u)v.skinning=true;if(i)v.vertexTangents=true;if(s)v.vertexColors=THREE.VertexColors;if(o)v.flatShading=true;if(l)v.morphTargets=true;if(f)v.morphNormals=true;this.cache.add(p,v)}t=v}if(t.aoMap&&r.attributes.uv2===undefined&&r.attributes.uv!==undefined){console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap.");r.addAttribute("uv2",new THREE.BufferAttribute(r.attributes.uv.array,2))}if(t.isGLTFSpecularGlossinessMaterial){e.onBeforeRender=n[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms}e.material=t};K.prototype.loadMaterial=function(e){var r=this;var t=this.json;var n=this.extensions;var i=t.materials[e];var s;var o={};var u=i.extensions||{};var l=[];if(u[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var f=n[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=f.getMaterialType();l.push(f.extendParams(o,i,r))}else if(u[a.KHR_MATERIALS_UNLIT]){var p=n[a.KHR_MATERIALS_UNLIT];s=p.getMaterialType();l.push(p.extendParams(o,i,r))}else{s=THREE.MeshStandardMaterial;var c=i.pbrMetallicRoughness||{};o.color=new THREE.Color(1,1,1);o.opacity=1;if(Array.isArray(c.baseColorFactor)){var d=c.baseColorFactor;o.color.fromArray(d);o.opacity=d[3]}if(c.baseColorTexture!==undefined){l.push(r.assignTexture(o,"map",c.baseColorTexture))}o.metalness=c.metallicFactor!==undefined?c.metallicFactor:1;o.roughness=c.roughnessFactor!==undefined?c.roughnessFactor:1;if(c.metallicRoughnessTexture!==undefined){l.push(r.assignTexture(o,"metalnessMap",c.metallicRoughnessTexture));l.push(r.assignTexture(o,"roughnessMap",c.metallicRoughnessTexture))}}if(i.doubleSided===true){o.side=THREE.DoubleSide}var v=i.alphaMode||w.OPAQUE;if(v===w.BLEND){o.transparent=true}else{o.transparent=false;if(v===w.MASK){o.alphaTest=i.alphaCutoff!==undefined?i.alphaCutoff:.5}}if(i.normalTexture!==undefined&&s!==THREE.MeshBasicMaterial){l.push(r.assignTexture(o,"normalMap",i.normalTexture));o.normalScale=new THREE.Vector2(1,1);if(i.normalTexture.scale!==undefined){o.normalScale.set(i.normalTexture.scale,i.normalTexture.scale)}}if(i.occlusionTexture!==undefined&&s!==THREE.MeshBasicMaterial){l.push(r.assignTexture(o,"aoMap",i.occlusionTexture));if(i.occlusionTexture.strength!==undefined){o.aoMapIntensity=i.occlusionTexture.strength}}if(i.emissiveFactor!==undefined&&s!==THREE.MeshBasicMaterial){o.emissive=(new THREE.Color).fromArray(i.emissiveFactor)}if(i.emissiveTexture!==undefined&&s!==THREE.MeshBasicMaterial){l.push(r.assignTexture(o,"emissiveMap",i.emissiveTexture))}return Promise.all(l).then(function(){var e;if(s===THREE.ShaderMaterial){e=n[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o)}else{e=new s(o)}if(i.name!==undefined)e.name=i.name;if(e.map)e.map.encoding=THREE.sRGBEncoding;if(e.emissiveMap)e.emissiveMap.encoding=THREE.sRGBEncoding;if(e.specularMap)e.specularMap.encoding=THREE.sRGBEncoding;O(e,i);if(i.extensions)N(n,e,i);return e})};function j(e,r,a){var t=r.attributes;var n=[];function i(r,t){return a.getDependency("accessor",r).then(function(r){e.addAttribute(t,r)})}for(var s in t){var o=H[s]||s.toLowerCase();if(o in e.attributes)continue;n.push(i(t[s],o))}if(r.indices!==undefined&&!e.index){var u=a.getDependency("accessor",r.indices).then(function(r){e.setIndex(r)});n.push(u)}O(e,r);return Promise.all(n).then(function(){return r.targets!==undefined?U(e,r.targets,a):e})}K.prototype.loadGeometries=function(e){var r=this;var t=this.extensions;var n=this.primitiveCache;function i(e){return t[a.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then(function(a){return j(a,e,r)})}var s=[];for(var o=0,u=e.length;o<u;o++){var l=e[o];var f=G(l);var p=n[f];if(p){s.push(p.promise)}else{var c;if(l.extensions&&l.extensions[a.KHR_DRACO_MESH_COMPRESSION]){c=i(l)}else{c=j(new THREE.BufferGeometry,l,r)}n[f]={primitive:l,promise:c};s.push(c)}}return Promise.all(s)};K.prototype.loadMesh=function(e){var r=this;var a=this.json;var t=this.extensions;var n=a.meshes[e];var i=n.primitives;var s=[];for(var o=0,u=i.length;o<u;o++){var l=i[o].material===undefined?P():this.getDependency("material",i[o].material);s.push(l)}return Promise.all(s).then(function(a){return r.loadGeometries(i).then(function(t){var s=[];for(var o=0,u=t.length;o<u;o++){var l=t[o];var f=i[o];var p;var c=a[o];if(f.mode===h.TRIANGLES||f.mode===h.TRIANGLE_STRIP||f.mode===h.TRIANGLE_FAN||f.mode===undefined){p=n.isSkinnedMesh===true?new THREE.SkinnedMesh(l,c):new THREE.Mesh(l,c);if(p.isSkinnedMesh===true)p.normalizeSkinWeights();if(f.mode===h.TRIANGLE_STRIP){p.drawMode=THREE.TriangleStripDrawMode}else if(f.mode===h.TRIANGLE_FAN){p.drawMode=THREE.TriangleFanDrawMode}}else if(f.mode===h.LINES){p=new THREE.LineSegments(l,c)}else if(f.mode===h.LINE_STRIP){p=new THREE.Line(l,c)}else if(f.mode===h.LINE_LOOP){p=new THREE.LineLoop(l,c)}else if(f.mode===h.POINTS){p=new THREE.Points(l,c)}else{throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode)}if(Object.keys(p.geometry.morphAttributes).length>0){D(p,n)}p.name=n.name||"mesh_"+e;if(t.length>1)p.name+="_"+o;O(p,n);r.assignFinalMaterial(p);s.push(p)}if(s.length===1){return s[0]}var d=new THREE.Group;for(var o=0,u=s.length;o<u;o++){d.add(s[o])}return d})})};K.prototype.loadCamera=function(e){var r;var a=this.json.cameras[e];var t=a[a.type];if(!t){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}if(a.type==="perspective"){r=new THREE.PerspectiveCamera(THREE.Math.radToDeg(t.yfov),t.aspectRatio||1,t.znear||1,t.zfar||2e6)}else if(a.type==="orthographic"){r=new THREE.OrthographicCamera(t.xmag/-2,t.xmag/2,t.ymag/2,t.ymag/-2,t.znear,t.zfar)}if(a.name!==undefined)r.name=a.name;O(r,a);return Promise.resolve(r)};K.prototype.loadSkin=function(e){var r=this.json.skins[e];var a={joints:r.joints};if(r.inverseBindMatrices===undefined){return Promise.resolve(a)}return this.getDependency("accessor",r.inverseBindMatrices).then(function(e){a.inverseBindMatrices=e;return a})};K.prototype.loadAnimation=function(e){var r=this.json;var a=r.animations[e];var t=[];var n=[];var i=[];var s=[];var o=[];for(var u=0,l=a.channels.length;u<l;u++){var f=a.channels[u];var p=a.samplers[f.sampler];var c=f.target;var d=c.node!==undefined?c.node:c.id;var h=a.parameters!==undefined?a.parameters[p.input]:p.input;var E=a.parameters!==undefined?a.parameters[p.output]:p.output;t.push(this.getDependency("node",d));n.push(this.getDependency("accessor",h));i.push(this.getDependency("accessor",E));s.push(p);o.push(c)}return Promise.all([Promise.all(t),Promise.all(n),Promise.all(i),Promise.all(s),Promise.all(o)]).then(function(r){var t=r[0];var n=r[1];var i=r[2];var s=r[3];var o=r[4];var u=[];for(var l=0,f=t.length;l<f;l++){var p=t[l];var c=n[l];var d=i[l];var h=s[l];var E=o[l];if(p===undefined)continue;p.updateMatrix();p.matrixAutoUpdate=true;var m;switch(A[E.path]){case A.weights:m=THREE.NumberKeyframeTrack;break;case A.rotation:m=THREE.QuaternionKeyframeTrack;break;case A.position:case A.scale:default:m=THREE.VectorKeyframeTrack;break}var T=p.name?p.name:p.uuid;var R=h.interpolation!==undefined?_[h.interpolation]:THREE.InterpolateLinear;var g=[];if(A[E.path]===A.weights){p.traverse(function(e){if(e.isMesh===true&&e.morphTargetInfluences){g.push(e.name?e.name:e.uuid)}})}else{g.push(T)}for(var M=0,S=g.length;M<S;M++){var L=new m(g[M]+"."+A[E.path],c.array,d.array,R);if(h.interpolation==="CUBICSPLINE"){L.createInterpolant=function e(r){return new v(this.times,this.values,this.getValueSize()/3,r)};L.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=true}u.push(L)}}var y=a.name!==undefined?a.name:"animation_"+e;return new THREE.AnimationClip(y,undefined,u)})};K.prototype.loadNode=function(e){var r=this.json;var t=this.extensions;var n=this;var i=r.meshReferences;var s=r.meshUses;var o=r.nodes[e];return function(){if(o.isBone===true){return Promise.resolve(new THREE.Bone)}else if(o.mesh!==undefined){return n.getDependency("mesh",o.mesh).then(function(e){var r;if(i[o.mesh]>1){var a=s[o.mesh]++;r=e.clone();r.name+="_instance_"+a;r.onBeforeRender=e.onBeforeRender;for(var t=0,n=r.children.length;t<n;t++){r.children[t].name+="_instance_"+a;r.children[t].onBeforeRender=e.children[t].onBeforeRender}}else{r=e}if(o.weights!==undefined){r.traverse(function(e){if(!e.isMesh)return;for(var r=0,a=o.weights.length;r<a;r++){e.morphTargetInfluences[r]=o.weights[r]}})}return r})}else if(o.camera!==undefined){return n.getDependency("camera",o.camera)}else if(o.extensions&&o.extensions[a.KHR_LIGHTS_PUNCTUAL]&&o.extensions[a.KHR_LIGHTS_PUNCTUAL].light!==undefined){return n.getDependency("light",o.extensions[a.KHR_LIGHTS_PUNCTUAL].light)}else{return Promise.resolve(new THREE.Object3D)}}().then(function(e){if(o.name!==undefined){e.name=THREE.PropertyBinding.sanitizeNodeName(o.name)}O(e,o);if(o.extensions)N(t,e,o);if(o.matrix!==undefined){var r=new THREE.Matrix4;r.fromArray(o.matrix);e.applyMatrix(r)}else{if(o.translation!==undefined){e.position.fromArray(o.translation)}if(o.rotation!==undefined){e.quaternion.fromArray(o.rotation)}if(o.scale!==undefined){e.scale.fromArray(o.scale)}}return e})};K.prototype.loadScene=function(){function e(r,a,t,n){var i=t.nodes[r];return n.getDependency("node",r).then(function(e){if(i.skin===undefined)return e;var r;return n.getDependency("skin",i.skin).then(function(e){r=e;var a=[];for(var t=0,i=r.joints.length;t<i;t++){a.push(n.getDependency("node",r.joints[t]))}return Promise.all(a)}).then(function(a){var t=e.isGroup===true?e.children:[e];for(var n=0,i=t.length;n<i;n++){var s=t[n];var o=[];var u=[];for(var l=0,f=a.length;l<f;l++){var p=a[l];if(p){o.push(p);var c=new THREE.Matrix4;if(r.inverseBindMatrices!==undefined){c.fromArray(r.inverseBindMatrices.array,l*16)}u.push(c)}else{console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[l])}}s.bind(new THREE.Skeleton(o,u),s.matrixWorld)}return e})}).then(function(r){a.add(r);var s=[];if(i.children){var o=i.children;for(var u=0,l=o.length;u<l;u++){var f=o[u];s.push(e(f,r,t,n))}}return Promise.all(s)})}return function r(a){var t=this.json;var n=this.extensions;var i=this.json.scenes[a];var s=this;var o=new THREE.Scene;if(i.name!==undefined)o.name=i.name;O(o,i);if(i.extensions)N(n,o,i);var u=i.nodes||[];var l=[];for(var f=0,p=u.length;f<p;f++){l.push(e(u[f],o,t,s))}return Promise.all(l).then(function(){return o})}}();return e}();
//# sourceMappingURL=GLTFLoader.min.min.js.map